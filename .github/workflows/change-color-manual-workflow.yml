name: Manual workflow

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Primary Color'
        default: ''
        required: true

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout project workspace repository
        uses: actions/checkout@v3
        with:
          repository: anct-cartographie-nationale/client-base

      - name: Checkout client-application repository
        uses: actions/checkout@v3
        with:
          path: projects/client-application

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16.x'
          cache: 'yarn'

      - name: Install dependencies
        run: |
          yarn
          yarn add @gouvfr-anct/mediation-numerique

      - name: Main theme color change
        run: |
          cd projects/client-application/src
          defaultColor=$($primary | grep primary styles.scss)
          newColor='$primary: ${{ github.event.inputs.name }};'
          sed -i "s/$defaultColor/$newColor/g" styles.scss

      - name: Theme has been changed
        run: echo "La couleur du nouveau thÃ¨me est ${{ github.event.inputs.name }}"

      - name: Build
        run: |
          yarn build client-application --named-chunks --output-hashing none

      - name: Add readme, license and package files
        run: |
          mv projects/client-application/README.md dist/client-application/
          mv projects/client-application/LICENSE.md dist/client-application/
          mv projects/client-application/package.json dist/client-application/
      - name: Merge all script files
        run: cat dist/client-application/*.js > dist/client-application/script.js

      - name: Upload build artifact
        uses: actions/upload-artifact@v3
        with:
          name: build
          path: dist
