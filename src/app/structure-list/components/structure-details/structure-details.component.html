<app-structureForm
  *ngIf="showForm"
  [idStructure]="structure._id"
  [isEditMode]="isEditMode"
  [profile]="currentProfile"
  (closeEvent)="updateStructure($event)"
  (clickOutside)="displayForm()"
></app-structureForm>
<div class="structrue-details-container" *ngIf="structure && !isLoading">
  <!-- Header info -->
  <div fxLayout="row" fxLayoutAlign="end center">
    <div (click)="close()" class="ico-close-details"></div>
  </div>
  <div fxLayout="row" class="structure-details-block" fxLayoutAlign="baseline baseline" fxLayoutGap="8px">
    <div fxLayout="column" fxLayoutGap="10px" fxFlex="100%">
      <div fxLayout="column" fxLayoutAlign="space-between start">
        <h2 class="bold">{{ structure.structureName }}</h2>
      </div>
      <div fxLayout="row" fxLayoutAlign="space-between center">
        <div class="typeInformationHeader" fxLayout="column">
          <h3>{{ structure.getLabelTypeStructure() }}</h3>
          <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="7px" *ngIf="structure.hasEquipments()">
            <app-svg-icon
              *ngFor="let equipement of structure.equipmentsAndServices"
              [type]="'ico'"
              [iconColor]="'currentColor'"
              [icon]="structure.getEquipmentsIcon(equipement)"
            ></app-svg-icon>
          </div>
        </div>
        <div class="printButton" fxLayout="column" fxLayoutAlign="end">
          <app-button
            class="hide-on-print"
            [type]="'button'"
            [style]="'buttonWithHash'"
            [text]="'Imprimer'"
            [iconBtn]="'print'"
            (action)="print()"
          ></app-button>
        </div>
      </div>
      <div fxLayout="row" fxLayout.lt-sm="column">
        <div fxLayout="column" fxFlex="50%">
          <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="13px">
            <app-structure-opening-status
              class="hide-on-print"
              [structure]="structure"
              [isCalledByDetails]="true"
            ></app-structure-opening-status>
          </div>
          <div *ngIf="structure.address" fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'adress'"></app-svg-icon>
            <p>{{ structure.address.numero }} {{ structure.address.street }}, {{ structure.address.commune }}</p>
          </div>
          <div *ngIf="structure.website" fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'web'"></app-svg-icon>
            <a
              target="_blank"
              class="custom-link"
              rel="noopener noreferrer"
              [href]="structure.website.includes('http') ? structure.website : 'http://' + structure.website"
              >{{ structure.website | url }}</a
            >
          </div>
          <div *ngIf="structure.contactPhone" fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'tel'"></app-svg-icon>
            <p>{{ structure.contactPhone | phone }}</p>
          </div>
        </div>
        <div fxLayout="column" fxFlex="50%">
          <div *ngIf="structure.contactMail" fxLayout="row" fxLayoutAlign="none center" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'email'"></app-svg-icon>
            <p>{{ structure.contactMail }}</p>
          </div>
          <div *ngIf="structure.hasPassNumeric()" fxLayout="row" fxLayoutAlign="none center" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'pass'"></app-svg-icon>
            <p>agréé Pass Numérique</p>
          </div>
          <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="13px">
            <app-svg-icon [type]="'ico'" [icon]="'calendar'"></app-svg-icon>
            <p>Mise à jour le {{ structure.updatedAt | date: 'mediumDate' }}</p>
          </div>
        </div>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center">
        <a *ngIf="!isClaimed" (click)="claimStructure()" class="primary" tabindex="0">Revendiquer cette structure</a>
        <a
          *ngIf="profileService.isLinkedToStructure(structure._id) || profileService.isAdmin()"
          (click)="editStructure()"
          class="primary"
          tabindex="0"
        >
          Modifier cette structure
        </a>
      </div>
      <div>
        {{ structure.description }}
      </div>
      <div class="info">
        {{ structure.lockdownActivity }}
      </div>
    </div>
  </div>
  <!-- Démarches en ligne -->
  <div
    *ngIf="structure.proceduresAccompaniment.length"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
    fxLayoutGap="20px"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'demarches'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Démarches en ligne</h2>
    </div>
    <div fxLayout="column">
      <div fxLayout="row wrap" fxLayoutGap="24px">
        <div *ngFor="let accompagnement of structure.proceduresAccompaniment">
          <app-logo-card *ngIf="accompagnement != 'autres'" [name]="accompagnement"></app-logo-card>
        </div>
      </div>
      <p *ngIf="isOtherSection">
        Tout ce qui est en lien avec la création d'entreprise ex : consultation de sites de références (BPI, Je créé
        dans ma région, ...), inscription à des newsletters, aide pour trouver des sites (CMA, CCI, Urssaf,...),
        recherches d'infos sur moteur de recherche...
      </p>
    </div>
  </div>
  <!-- Services -->
  <div
    *ngIf="isBaseSkills() || isAccessRights()"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
    fxLayoutGap="20px"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'services'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Ateliers</h2>
    </div>
    <div fxLayout="row" class="w-100" fxLayout.lt-sm="column">
      <div fxFlex="50%" *ngIf="isBaseSkills()">
        <h3 class="subtitle">Compétences de base</h3>
        <p *ngFor="let skill of baseSkills">{{ skill.text }}</p>
      </div>
      <div fxFlex="50%" *ngIf="isAccessRights()">
        <h3 class="subtitle">Accès aux droits</h3>
        <p *ngFor="let rights of accessRights">{{ rights.text }}</p>
      </div>
    </div>
  </div>
  <!-- Accueil -->
  <div
    *ngIf="structure.accessModality.length > 0 || structure.hours.hasData()"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
    fxLayoutGap="20px"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'accueil'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Accueil</h2>
    </div>
    <!-- Openning Hours -->
    <div fxLayout="row" class="w-100" fxLayout.lt-sm="column">
      <div *ngIf="structure.hours.hasData()" fxFlex="50%">
        <h3 class="subtitle">Horaires d’ouverture au public</h3>
        <div fxLayout="column">
          <div *ngFor="let day of structure.hours | keyvalue: keepOriginalOrder">
            <div *ngIf="day.value.open">
              <h4>{{ day.key | day }}</h4>
              <div class="openning-time" fxLayout="row" fxLayoutAlign="none flex-end">
                <div *ngFor="let timeRange of day.value.time; let isFirst = first">
                  <p *ngIf="isFirst">de {{ timeRange.formatOpenningDate() }} à {{ timeRange.formatClosingDate() }}</p>
                  <p *ngIf="!isFirst && timeRange.openning">
                    et de {{ timeRange.formatOpenningDate() }} à {{ timeRange.formatClosingDate() }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- accessModality -->
      <div *ngIf="structure.accessModality.length > 0" fxFlex="50%">
        <h3 class="subtitle">Accès</h3>
        <div
          *ngFor="let acces of structure.accessModality"
          fxLayout="row"
          fxLayoutAlign="none flex-end"
          fxLayoutGap="8px"
        >
          <app-svg-icon [type]="'ico'" [icon]="getAccessIcon(acces)"></app-svg-icon>
          <p>{{ getAccessLabel(acces) }}</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Equipements -->
  <div
    *ngIf="structure.hasEquipments()"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'equipement'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Équipements</h2>
    </div>
    <div
      fxLayout="row"
      fxLayoutAlign="none flex-end"
      fxLayoutGap="13px"
      *ngFor="let equipement of structure.equipmentsAndServices"
    >
      <p>
        {{ getEquipmentsLabel(equipement) }}
        <span *ngIf="equipement == 'ordinateurs' && structure.nbComputers"> : {{ structure.nbComputers }}</span>
        <span *ngIf="equipement == 'tablettes' && structure.nbTablets"> : {{ structure.nbTablets }}</span>
        <span *ngIf="equipement == 'bornesNumeriques' && structure.nbNumericTerminal">
          : {{ structure.nbNumericTerminal }}</span
        >
        <span *ngIf="equipement == 'imprimantes' && structure.nbPrinters"> : {{ structure.nbPrinters }}</span>
      </p>
    </div>
  </div>
  <!-- Labels -->
  <div
    *ngIf="structure.labelsQualifications.length"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
    fxLayoutGap="20px"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'label'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Labelisation</h2>
    </div>
    <div fxLayout="row wrap" fxLayoutGap="24px">
      <div *ngFor="let labels of structure.labelsQualifications">
        <app-logo-card [name]="labels"></app-logo-card>
      </div>
    </div>
  </div>
  <!-- Transport -->
  <div
    *ngIf="tclStopPoints.length"
    fxLayout="column"
    class="structure-details-block"
    fxLayoutAlign="baseline baseline"
    fxLayoutGap="20px"
  >
    <div fxLayout="row" fxLayoutAlign="none flex-end" fxLayoutGap="8px">
      <app-svg-icon [type]="'ico'" [icon]="'transport'" [iconClass]="'icon-32'"></app-svg-icon>
      <h2>Accès</h2>
    </div>
    <div fxLayout="column wrap" fxLayoutGap="24px">
      <div *ngFor="let tclStop of tclStopPoints">
        {{ tclStop.name }}
        <div fxLayout="row wrap" fxLayoutGap="24px">
          <p *ngFor="let sub of tclStop.subLines">
            <app-svg-icon [type]="'tcl'" [icon]="sub" [iconClass]="'icon-75'"></app-svg-icon>
          </p>
          <p *ngFor="let tram of tclStop.tramLines">
            <app-svg-icon [type]="'tcl'" [icon]="tram" [iconClass]="'icon-75'"></app-svg-icon>
          </p>
          <p *ngFor="let bus of tclStop.busLines">
            <app-svg-icon [type]="'tcl'" [icon]="bus" [iconClass]="'icon-75'"></app-svg-icon>
            <!-- {{ bus }} -->
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
