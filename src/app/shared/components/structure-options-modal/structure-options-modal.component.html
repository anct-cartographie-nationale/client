<nav aria-label="modalOption">
  <ul>
    <li>
      <button [ngClass]="{ active: active }" (click)="openModalOpts()" class="btn-primary transparent">
        <app-svg-icon [type]="'ico'" [iconColor]="'inherit'" [icon]="'moreOpts'"></app-svg-icon>
      </button>
      <ul *ngIf="showModalOption" class="dropdown">
        <app-modal-options
          [isModalProfileOpts]="!structure"
          [isEditFormView]="structure && isEditFormView"
          [hasOwners]="structure && structure.owners.length > 0"
          (closed)="closeModalOpts($event)"
        ></app-modal-options>
      </ul>
    </li>
  </ul>
</nav>
<div *ngIf="editModal" class="modalBackground">
  <div class="modal" (clickOutside)="closeModalOptsProfile()">
    <form
      *ngIf="editModal == typeModalProfile.password"
      [formGroup]="formPassword"
      class="contentModal"
      fxLayout="column"
      fxLayoutAlign="center start"
      fxLayoutGap="20px"
    >
      <div fxLayout="row" class="headerModal" fxLayoutAlign="space-between center">
        <h2>Changer de mot de passe</h2>
        <div class="ico-close-details" (click)="closeModalOptsProfile()"></div>
      </div>
      <div class="form-group" fxLayout="column" fxLayoutGap="4px">
        <label for="oldPassword">Ancien mot de passe</label>
        <p *ngIf="passwordError" class="special invalid">Votre ancien mot de passe est incorrect.</p>
        <div fxLayout="row" fxLayoutGap="13px">
          <input
            [type]="isShowOldPassword ? 'text' : 'password'"
            formControlName="oldPassword"
            class="form-input password"
            autocomplete="on"
          />
          <app-svg-icon
            (click)="showOldPassword()"
            [type]="'form'"
            [iconClass]="'grey'"
            [icon]="'eyePassword'"
          ></app-svg-icon>
          <app-svg-icon *ngIf="passwordError" [type]="'form'" [icon]="'notValidate'"></app-svg-icon>
        </div>
      </div>
      <div class="form-group" fxLayout="column">
        <label for="password">Nouveau mot de passe</label>
        <p class="special" [ngClass]="{ invalid: fpass.password.invalid && fpass.password.value }">
          Le mot de passe doit contenir au minimum : 8 caractères dont un caractère spécial, un caractère en majuscule
          et un chiffre.
        </p>
        <div fxLayout="row" fxLayoutGap="13px">
          <input
            [type]="isShowPassword ? 'text' : 'password'"
            formControlName="password"
            class="form-input password"
            autocomplete="on"
          />
          <app-svg-icon
            (click)="showPassword()"
            [type]="'form'"
            [iconClass]="'grey'"
            [icon]="'eyePassword'"
          ></app-svg-icon>
          <app-svg-icon *ngIf="fpass.password.valid" [type]="'form'" [icon]="'validate'"></app-svg-icon>
          <app-svg-icon
            *ngIf="fpass.password.invalid && fpass.password.value"
            [type]="'form'"
            [icon]="'notValidate'"
          ></app-svg-icon>
        </div>
      </div>
      <div class="form-group" fxLayout="column">
        <label for="confirmPassword">Confirmation du mot de passe</label>
        <div fxLayout="row" fxLayoutGap="13px">
          <input
            [type]="isShowConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
            class="form-input password"
            autocomplete="on"
          />
          <app-svg-icon
            (click)="showConfirmPassword()"
            [type]="'form'"
            [iconClass]="'grey'"
            [icon]="'eyePassword'"
          ></app-svg-icon>
          <app-svg-icon
            *ngIf="fpass.confirmPassword.valid && fpass.password.value"
            [type]="'form'"
            [icon]="'validate'"
          ></app-svg-icon>
          <app-svg-icon
            *ngIf="fpass.confirmPassword.invalid && fpass.confirmPassword.value"
            [type]="'form'"
            [icon]="'notValidate'"
          ></app-svg-icon>
        </div>
      </div>
      <div class="footerModal" fxLayout="row" fxLayoutAlign="center center">
        <button
          type="submit"
          [ngClass]="{ invalid: formPassword.invalid }"
          class="btn-primary small leave"
          (click)="submitPassword()"
        >
          Valider
        </button>
      </div>
    </form>
    <form
      *ngIf="editModal == typeModalProfile.email"
      [formGroup]="formEmail"
      class="contentModal"
      fxLayout="column"
      fxLayoutAlign="center start"
    >
      <div fxLayout="row" class="headerModal" fxLayoutAlign="space-between center">
        <h2>Changer de courriel</h2>
        <div class="ico-close-details" (click)="closeModalOptsProfile()"></div>
      </div>
      <div class="form-group" fxLayout="column">
        <label for="email">Nouveau courriel</label>
        <p class="special invalid" *ngIf="this.fmail.email.hasError('alreadyExist')">L'email est déja utilisé.</p>
        <div fxLayout="row" fxLayoutGap="13px">
          <input
            type="text"
            formControlName="email"
            class="form-input"
            autocomplete="on"
            (keyup)="verifyEmailAlreadyUsed($event.target.value, this.fmail.email)"
          />
          <app-svg-icon *ngIf="fmail.email.valid" [type]="'form'" [icon]="'validate'"></app-svg-icon>
          <app-svg-icon
            *ngIf="fmail.email.invalid && fmail.email.value"
            [type]="'form'"
            [icon]="'notValidate'"
          ></app-svg-icon>
        </div>
      </div>
      <div class="footerModal" fxLayout="row" fxLayoutAlign="center center">
        <button
          type="submit"
          [ngClass]="{ invalid: formEmail.invalid }"
          class="btn-primary small leave"
          (click)="submitEmail()"
        >
          Valider
        </button>
      </div>
    </form>
    <div
      *ngIf="editModal == typeModalProfile.deleteAccount"
      class="contentModal"
      fxLayout="column"
      fxLayoutAlign="center start"
      fxLayoutGap="30px"
    >
      <div fxLayout="row" class="headerModal" fxLayoutAlign="space-between center">
        <h2>Supprimer un compte</h2>
        <div class="ico-close-details" (click)="closeModalOptsProfile()"></div>
      </div>
      <div fxLayout="column" fxLayoutGap="16px" class="ownersBlock">
        <div class="row removeOwner" *ngFor="let owner of structure.owners" fxLayoutGap="16px">
          <button class="btn-primary small" (click)="removeOwner(owner.id)">X</button>
          <span>
            {{ owner.email }}
          </span>
        </div>
      </div>
      <div class="footerModal" fxLayout="row" fxLayoutAlign="center center">
        <button type="button" class="btn-primary small leave" (click)="closeModalOptsProfile()">Terminer</button>
      </div>
    </div>
    <form
      *ngIf="editModal == typeModalProfile.addAccount"
      [formGroup]="formAddAccount"
      class="contentModal"
      fxLayout="column"
      fxLayoutAlign="center start"
      fxLayoutGap="30px"
    >
      <div fxLayout="row" class="headerModal" fxLayoutAlign="space-between center">
        <h2>Ajouter un compte</h2>
        <div class="ico-close-details" (click)="closeModalOptsProfile()"></div>
      </div>
      <div class="form-group" fxLayout="column">
        <label for="email">Courriel du compte à ajouter</label>
        <p *ngIf="ownerAlreadyLinked" class="special invalid">L'email est déjà rattaché à la structure.</p>
        <div fxLayout="row" fxLayoutGap="13px">
          <input type="text" formControlName="email" class="form-input" autocomplete="on" />
          <app-svg-icon *ngIf="fAddAccount.email.valid" [type]="'form'" [icon]="'validate'"></app-svg-icon>
          <app-svg-icon
            *ngIf="fAddAccount.email.invalid && fAddAccount.email.value"
            [type]="'form'"
            [icon]="'notValidate'"
          ></app-svg-icon>
        </div>
      </div>
      <div class="footerModal" fxLayout="row" fxLayoutAlign="center center">
        <button
          type="submit"
          [ngClass]="{ invalid: formAddAccount.invalid }"
          class="btn-primary small leave"
          (click)="addOwner()"
        >
          Envoyer
        </button>
      </div>
    </form>
  </div>
</div>
<app-modal-confirmation
  [openned]="deleteModalStructureOpenned"
  [content]="'Voulez-vous vraiment supprimer cette structure ?'"
  (closed)="deleteStructure($event)"
></app-modal-confirmation>
<app-modal-confirmation
  [openned]="deleteModalAccountOpenned"
  [content]="'Voulez-vous vraiment supprimer votre compte ?'"
  (closed)="deleteAccount($event)"
></app-modal-confirmation>
