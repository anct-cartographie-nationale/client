<div class="h-100 d-flex pt-5">
  <div class="w-100 my-auto">
    <h1 class="h2 text-center fw-bold mt-sm-5 mt-3">
      Quelles sont vos
      <span class="text-primary">disponibilités</span>
      &nbsp;?
    </h1>
    <p class="text-center fw-bold mb-sm-5 mb-4 text-muted">
      Indiquez quel(s) jour(s) et à quelle(s) heure(s) vous serez disponible
    </p>
    <form [formGroup]="orientationLayout.filterForm">
      <div class="accordion" id="accordionDisponibilite">
        <div class="accordion-item mb-3">
          <h2 class="accordion-header" id="headingDatePrecise">
            <button
              type="button"
              class="btn orientation-btn bg-light mb-3 p-3 rounded-0 d-flex position-relative w-100"
              aria-controls="collapseDatePrecise"
              [class.bg-white]="(collapseDatePrecise.isCollapsed$ | async) === false"
              [attr.aria-expanded]="collapseDatePrecise.isExpanded$ | async"
              (click)="collapseDatePrecise.toggle()">
              <span class="ri-circled bg-primary text-light fw-normal me-3 d-sm-block d-none">
                <i class="ri-calendar-todo-line" aria-hidden="true"></i>
              </span>
              <span class="orientation-btn-label my-auto text-start">Je cherche des lieux ouverts à une date précise</span>
              <span class="ms-auto me-3 end-0 d-flex">
                <button
                  class="btn p-0 border-0"
                  (click)="selectOrientationInformation(false); informationOrientationModal.control.toggle($event); $event.stopPropagation(); $event.preventDefault()">
                  <span class="visually-hidden">Info</span>
                  <i class="ri-information-line fw-normal ri-2x text-muted" aria-hidden="true"></i>
                </button>
                <i
                  class="ri-add-line ri-2x text-muted"
                  *ngIf="collapseDatePrecise.isCollapsed$ | async; else: expanded"
                  aria-hidden="true"></i>
                <ng-template #expanded>
                  <i class="ri-subtract-line ri-2x text-muted" aria-hidden="true"></i>
                </ng-template>
              </span>
            </button>
          </h2>
          <app-collapse
            #collapseDatePrecise
            id="collapseDatePrecise"
            [state]="hasOpeningsHours ? 'expanded' : 'collapsed'"
            aria-labelledby="headingDatePrecise">
            <fieldset class="accordion-body bg-light px-3 py-4">
              <legend class="visually-hidden">Filtres pour les horaires</legend>
              <app-opening-hours-form
                #openingHoursForm
                (selectOpeningHours)="onSelectOpeningHours($event)"
                [openingHours]="orientationLayout.filterForm.controls['horaires_ouverture'].value"></app-opening-hours-form>
              <div class="text-center mt-4">
                <button
                  type="button"
                  class="btn my-3 me-3 btn-secondary"
                  (click)="openingHoursForm.onResetOpeningHoursForm(); collapseDatePrecise.toggle()">
                  Annuler
                  <i class="ri-close-line" aria-hidden="true"></i>
                </button>
                <app-display-on-map-link
                  buttonStyle="primary"
                  [cartographieFeature]="features.get('cartographie')"
                  [lieuxMediationNumeriqueCount]="(orientationLayout.lieuxMediationNumeriqueCount$ | async) ?? 0"
                  [queryParams]="route.queryParams">
                  Afficher les résultats
                </app-display-on-map-link>
              </div>
            </fieldset>
          </app-collapse>
        </div>
      </div>
    </form>
    <ng-container *ngIf="collapseDatePrecise.isCollapsed$ | async">
      <app-text-separator>OU</app-text-separator>
      <div class="text-center">
        <ng-container *ngIf="features.get('cartographie') as cartographie">
          <a
            *ngIf="cartographie.active"
            class="btn orientation-btn bg-light mb-3 p-3 rounded-0 d-flex position-relative"
            [class.disabled]="((orientationLayout.lieuxMediationNumeriqueCount$ | async) ?? 0) === 0"
            [routerLink]="['/','cartographie']"
            queryParamsHandling="preserve">
            <span class="ri-circled bg-primary text-light fw-normal me-3 d-sm-block d-none">
              <i class="ri-road-map-line" aria-hidden="true"></i>
            </span>
            <span class="orientation-btn-label my-auto text-start">J’affiche tous les lieux correspondant à ma recherche</span>
            <span class="ms-auto me-3 end-0 d-flex">
              <button
                class="btn p-0 border-0"
                (click)="selectOrientationInformation(true); informationOrientationModal.control.toggle($event); $event.stopPropagation(); $event.preventDefault()">
                <span class="visually-hidden">Info</span>
                <i class="ri-information-line fw-normal ri-2x text-muted" aria-hidden="true"></i>
              </button>
              <i class="ri-arrow-right-s-line ri-2x text-muted my-auto" aria-hidden="true"></i>
            </span>
          </a>
          <a
            *ngIf="!cartographie.active && cartographie.url"
            class="btn orientation-btn bg-light mb-3 p-3 rounded-0 d-flex position-relative"
            [class.disabled]="((orientationLayout.lieuxMediationNumeriqueCount$ | async) ?? 0) === 0"
            [href]="cartographie.url + '?' + toQueryString($any(route.queryParams | async))"
            rel="keep-params">
            <span class="ri-circled bg-primary text-light fw-normal me-3">
              <i class="ri-road-map-line" aria-hidden="true"></i>
            </span>
            <span class="orientation-btn-label my-auto text-start">J’affiche tous les lieux correspondant à ma recherche</span>
            <span class="ms-auto me-3 end-0 d-flex">
              <button
                class="btn p-0 border-0"
                (click)="selectOrientationInformation(true); informationOrientationModal.control.toggle($event); $event.stopPropagation(); $event.preventDefault()">
                <span class="visually-hidden">Info</span>
                <i class="ri-information-line fw-normal ri-2x text-muted" aria-hidden="true"></i>
              </button>
              <i class="ri-arrow-right-s-line ri-2x text-muted" aria-hidden="true"></i>
            </span>
          </a>
        </ng-container>
      </div>
    </ng-container>
  </div>
</div>
<app-information-orientation-modal #informationOrientationModal [orientationInformation]="selectedOrientationInformation">
  <ng-container *ngIf="features.get('cartographie') as cartographie">
    <a
      *ngIf="cartographie.active && displayCartographieLink"
      [routerLink]="['/','cartographie']"
      queryParamsHandling="preserve"
      class="btn btn-primary"
      (click)="informationOrientationModal.control.close()">
      Afficher les résultats
      <i class="ri-arrow-right-s-line" aria-hidden="true"></i>
    </a>
    <a
      *ngIf="!cartographie.active && displayCartographieLink"
      [href]="cartographie.url + '?' + toQueryString($any(route.queryParams | async))"
      class="btn btn-primary"
      (click)="informationOrientationModal.control.close()">
      Afficher les résultats
      <i class="ri-arrow-right-s-line" aria-hidden="true"></i>
    </a>
  </ng-container>
</app-information-orientation-modal>
