<div class="bg-light h-100 p-5">
  <div class="container h-100">
    <div class="row g-0 h-100 shadow">
      <div class="col bg-white p-3 h-100 overflow-auto d-flex flex-column" *ngIf="(filterPresentation$ | async) as filter">
        <ul *ngIf="this.router.url !== '/orientation'" class="nav nav-pills justify-content-center pb-3">
          <li class="nav-item">
            <a
              class="btn btn-secondary mx-2 position-relative"
              [routerLink]="['besoin']"
              queryParamsHandling="preserve"
              routerLinkActive="active active-primary"
              ariaCurrentWhenActive="page">
              Besoin
              <span
                class="position-absolute top-0 start-100 translate-middle badge bg-primary rounded-circle"
                *ngIf="filter.services">
                1
              </span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="btn btn-secondary mx-2 position-relative"
              [routerLink]="['localisation']"
              queryParamsHandling="preserve"
              routerLinkActive="active active-primary"
              ariaCurrentWhenActive="page">
              Localisation
              <span
                class="position-absolute top-0 start-100 translate-middle badge bg-primary rounded-circle"
                *ngIf="filter.distance && filter.distance !== null">
                1
              </span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="btn btn-secondary mx-2 position-relative"
              [routerLink]="['accessibilite']"
              queryParamsHandling="preserve"
              routerLinkActive="active active-primary"
              ariaCurrentWhenActive="page">
              Accessibilité
              <span
                class="position-absolute top-0 start-100 translate-middle badge bg-primary rounded-circle"
                *ngIf="(filter.conditions_access && filter.conditions_access.length > 0 ) || (filter.publics_accueillis && filter.publics_accueillis.length > 0) || (filter.modalites_accompagnement && filter.modalites_accompagnement.length > 0)">
                {{(filter.conditions_access?.length || 0) + (filter.publics_accueillis?.length || 0) +
                (filter.modalites_accompagnement?.length || 0)}}
              </span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="btn btn-secondary mx-2 position-relative"
              [routerLink]="['disponibilite']"
              queryParamsHandling="preserve"
              routerLinkActive="active active-primary"
              ariaCurrentWhenActive="page">
              Disponibilité
              <span
                class="position-absolute top-0 start-100 translate-middle badge bg-primary rounded-circle"
                *ngIf="(filter.date_ouverture && filter.date_ouverture !== null) || (filter.ouvert_actuellement && filter.ouvert_actuellement !== null)">
                {{filter.ouvert_actuellement ? 2 : 1}}
              </span>
            </a>
          </li>
        </ul>
        <div class="h-100" [@routeAnimations]="getRouteAnimationData()">
          <router-outlet></router-outlet>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 col-12 bg-primary text-white h-100 p-4" *ngIf="this.router.url !== '/orientation'">
        <ng-container *ngIf="(lieuxMediationNumerique$ | async) as lieuxMediationNumerique">
          <div class="d-flex flex-column h-100" *ngIf="(lieuxMediationNumeriqueTotal$ | async) as lieuxMediationNumeriqueTotal">
            <h1 class="h2 text-center text-secondary fw-bold">
              Structures
              <br />
              <span *ngIf="router.url === '/orientation'">sur le territoire</span>
              <span *ngIf="router.url !== '/orientation'">correspondantes</span>
            </h1>
            <div class="text-center my-auto">
              <div class="bg-image p-5" style="background-image: url('assets/logos/carteFrancePerspective.svg')">
                <div class="d-flex p-2">
                  <div class="border rounded-circle p-4 m-auto">
                    <div
                      [attr.aria-valuemax]="lieuxMediationNumeriqueTotal.length"
                      [attr.aria-valuenow]="lieuxMediationNumerique.length"
                      aria-valuemin="0"
                      role="progressbar"
                      style="--value-int: {{lieuxMediationNumerique.length}} ; --value-percentage: {{(lieuxMediationNumerique.length / lieuxMediationNumeriqueTotal.length) * 100}}"></div>
                  </div>
                </div>
              </div>
              <ng-container *ngIf="router.url !==  '/orientation'">
                <b class="fs-5 text" [ngPlural]="lieuxMediationNumerique.length">
                  <ng-template ngPluralCase="=0">Structure trouvée</ng-template>
                  <ng-template ngPluralCase="=1">Structure trouvée</ng-template>
                  <ng-template ngPluralCase="other">Structures trouvées</ng-template>
                </b>
                <br />
                <span class="opacity-50">/ {{ lieuxMediationNumeriqueTotal.length }} structures sur le territoire</span>
              </ng-container>
            </div>

            <!-- here -->
            <form [formGroup]="filterForm">
              <ng-container *ngIf="(filterPresentation$ | async) as filter">
                <div
                  class="form-check form-check-inline form-chip mb-3"
                  *ngFor="let publicAccueilli of filter.publics_accueillis">
                  <button (click)="resetForm()">{{ publicAccueilli }}</button>
                </div>
              </ng-container>
            </form>
            <!--            <form [formGroup]="filterForm">-->
            <!--              <div *ngIf="(filterPresentation$ | async) as filter" class="text-center">-->
            <!--                <div-->
            <!--                  class="form-check form-check-inline form-chip mb-1"-->
            <!--                  *ngFor="let public of filter.publics_accueillis; index as i">-->
            <!--                  <input-->
            <!--                    #publicsAccueillis-->
            <!--                    type="checkbox"-->
            <!--                    name="publics_accueillis"-->
            <!--                    appCheckboxArray-->
            <!--                    formControlName="publics_accueillis"-->
            <!--                    class="form-check-input"-->
            <!--                    [value]="public"-->
            <!--                    [attr.id]="'test' + i" />-->
            <!--                  <label class="form-check-label bg-secondary text-primary" [attr.for]="'test' + i">-->
            <!--                    <i-->
            <!--                      class="align-bottom"-->
            <!--                      [class]="publicsAccueillis.checked ? 'ri-radio-button-line' : 'ri-checkbox-blank-circle-line'"></i>-->
            <!--                    {{ public }}-->
            <!--                  </label>-->
            <!--                </div>-->
            <!-- <div
                    class="form-check form-check-inline form-chip mb-1"
                    *ngFor="let condition of filter.conditions_access; let i = index;">
                    <input class="form-check-input" appCheckboxArray #conditionsAccess type="checkbox" [value]="condition" />
                    <label class="form-check-label bg-primary text-white">
                      <i
                        class="align-bottom"
                        [class]="conditionsAccess.checked ? 'ri-radio-button-line' : 'ri-checkbox-blank-circle-line'"></i>
                      {{ condition }}
                    </label>
                  </div>
                  <div
                    class="form-check form-check-inline form-chip mb-1"
                    *ngFor="let modalite of filter.modalites_accompagnement; let i = index;">
                    <input class="form-check-input" appCheckboxArray #typesAccompagnement type="checkbox" [value]="modalite" />
                    <label class="form-check-label bg-primary text-white">
                      <i
                        class="align-bottom"
                        [class]="typesAccompagnement.checked ? 'ri-radio-button-line' : 'ri-checkbox-blank-circle-line'"></i>
                      {{ modalite }}
                    </label>
                  </div>
                  <div
                    class="form-check form-check-inline form-chip mb-1"
                    *ngIf="filter.services && filter.services.length > 0">
                    <input class="form-check-input" appUncheckableRadio type="radio" [value]="filter.services" />
                    <label class="form-check-label bg-primary text-white">{{ filter.services }}</label>
                  </div>
                </div> -->
            <!--              </div>-->
            <!--            </form>-->
            <!-- until here -->
            <div class="text-center mt-auto">
              <ng-container *ngIf="features.get('cartographie') as cartographie">
                <a
                  *ngIf="cartographie.active"
                  class="btn btn-secondary"
                  [class.disabled]="lieuxMediationNumerique.length === 0"
                  [routerLink]="['/','cartographie']"
                  queryParamsHandling="preserve">
                  Afficher les résultats sur la cartographie
                  <i class="ri-arrow-right-s-line align-bottom"></i>
                </a>
                <a
                  *ngIf="!cartographie.active && cartographie.url"
                  class="btn btn-secondary"
                  [class.disabled]="lieuxMediationNumerique.length === 0"
                  [href]="cartographie.url + '?' + toQueryString($any(route.queryParams | async))"
                  rel="keep-params">
                  Afficher les résultats sur la cartographie
                  <i class="ri-arrow-right-s-line align-bottom"></i>
                </a>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
