<form [formGroup]="formGroup" class="position-relative">
  <label for="address" class="visually-hidden">Quelle est votre adresse ?</label>
  <i class="text-muted ri-search-line ri-lg position-absolute mt-2 ms-2 ps-1 z-index-over-base" aria-hidden="true"></i>
  <div class="input-group">
    <input
      #addressInput
      type="search"
      placeholder="Entrez une adresse"
      name="address"
      id="address"
      class="form-control ps-5"
      autocomplete="off"
      aria-describedby="address"
      aria-haspopup="true"
      formControlName="address"
      [attr.aria-describedby]="addressNotFound ? 'address-desc-error' : null"
      [attr.aria-expanded]="dropdownPane.expanded$ | async"
      (input)="search(addressInput.value); addressInput.value.length <= 3 ? dropdownPane.reduce() : dropdownPane.expand()"
      (focus)="addressInput.value.length <= 3 ? dropdownPane.reduce() : dropdownPane.expand()"
      (keyup.escape)="dropdownPane.reduce()"
      (keyup.enter)="dropdownPane.activeIndex = 0; dropdownPane.focus()" />
    <button type="button" *ngIf="addressInput.value && displayReset" class="btn input-group-btn" (click)="clear()">
      <span class="visually-hidden">Effacer</span>
      <i class="ri-close-line" aria-hidden="true"></i>
    </button>
    <ng-content></ng-content>
  </div>
  <ul
    #dropdownPane="dropdownPane"
    appDropdownPane
    [dropdownControl]="addressInput"
    [class.show]="(dropdownPane.expanded$ | async) && addressSuggestions.length > 0"
    class="dropdown-menu position-absolute mt-1"
    aria-labelledby="address">
    <li *ngFor="let address of addressSuggestions; index as addressIndex; trackBy: trackByAddressName">
      <button
        type="button"
        class="dropdown-item"
        [class.active]="dropdownPane.activeIndex === addressIndex"
        [attr.aria-current]="dropdownPane.activeIndex === addressIndex ? true : null"
        (focusin)="dropdownPane.setIndex(addressIndex)"
        (focusout)="dropdownPane.setIndex(-1)"
        (click)="setAddressSuggestion(address); dropdownPane.reduce()">
        <b>{{ address.label }}</b>
        <br />
        <small>{{ address.context }}</small>
      </button>
    </li>
  </ul>
</form>
